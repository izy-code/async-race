"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[384],{837:(x,R,u)=>{u.d(R,{Ay:()=>G,gx:()=>m,xB:()=>L});var C=Object.defineProperty,b=(d,i,l)=>i in d?C(d,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):d[i]=l,a=(d,i,l)=>(b(d,typeof i!="symbol"?i+"":i,l),l),_=(d,i,l)=>new Promise((E,N)=>{var K=O=>{try{w(l.next(O))}catch(H){N(H)}},V=O=>{try{w(l.throw(O))}catch(H){N(H)}},w=O=>O.done?E(O.value):Promise.resolve(O.value).then(K,V);w((l=l.apply(d,i)).next())});const p="http://127.0.0.1:3000",A=200,c={"Content-Type":"application/json"};var o=(d=>(d.GET="GET",d.POST="POST",d.PUT="PUT",d.DELETE="DELETE",d.PATCH="PATCH",d))(o||{}),s=(d=>(d.GARAGE="garage",d.ENGINE="engine",d.WINNERS="winners",d))(s||{}),g=(d=>(d.STARTED="started",d.STOPPED="stopped",d.DRIVE="drive",d))(g||{}),m=(d=>(d.ID="id",d.WINS="wins",d.TIME="time",d))(m||{}),L=(d=>(d.ASC="ASC",d.DESC="DESC",d))(L||{});const y=class v{static getFetchResponse(i,l){return _(this,null,function*(){return yield fetch(i,l)})}static getCars(i,l){return _(this,null,function*(){const E=yield v.getFetchResponse(`${p}/garage?_page=${i!=null?i:""}&_limit=${l!=null?l:""}`),N=yield E.json(),K=E.headers.get("X-Total-Count");return{cars:N,totalCount:K}})}static getCar(i){return _(this,null,function*(){return(yield v.getFetchResponse(`${p}/garage/${i}`)).json()})}static createCar(i,l){return _(this,null,function*(){yield v.getFetchResponse(`${p}/garage`,{method:"POST",headers:c,body:JSON.stringify({name:i,color:l})})})}static deleteCar(i){return _(this,null,function*(){yield v.getFetchResponse(`${p}/garage/${i}`,{method:"DELETE"})})}static updateCar(i){return _(this,null,function*(){yield v.getFetchResponse(`${p}/garage/${i.id}`,{method:"PUT",headers:c,body:JSON.stringify({name:i.name,color:i.color})})})}static startEngine(i){return _(this,null,function*(){return(yield v.getFetchResponse(`${p}/engine?id=${i}&status=started`,{method:"PATCH"})).json()})}static stopEngine(i){return _(this,null,function*(){const l=v.abortControllers[i];l&&(l.abort(),delete v.abortControllers[i]),yield v.getFetchResponse(`${p}/engine?id=${i}&status=stopped`,{method:"PATCH"})})}static isDriveSuccessful(i){return _(this,null,function*(){const l=new AbortController;let E;v.abortControllers[i]=l;try{E=yield v.getFetchResponse(`${p}/engine?id=${i}&status=drive`,{method:"PATCH",signal:l.signal})}catch(N){if(N instanceof Error&&N.name!=="AbortError")throw N}return E?E.status===A:!1})}static getWinners(i,l,E,N){return _(this,null,function*(){const K=yield v.getFetchResponse(`${p}/winners?_page=${i!=null?i:""}&_limit=${l!=null?l:""}&_sort=${E!=null?E:""}&_order=${N!=null?N:""}`),V=yield K.json(),w=K.headers.get("X-Total-Count");return{winners:V,totalCount:w}})}static getWinner(i){return _(this,null,function*(){return(yield fetch(`${p}/winners/${i}`)).json()})}static createWinner(i,l,E){return _(this,null,function*(){yield v.getFetchResponse(`${p}/winners`,{method:"POST",headers:c,body:JSON.stringify({id:i,wins:l,time:E})})})}static deleteWinner(i){return _(this,null,function*(){yield v.getFetchResponse(`${p}/winners/${i}`,{method:"DELETE"})})}static updateWinner(i){return _(this,null,function*(){yield v.getFetchResponse(`${p}/winners/${i.id}`,{method:"PUT",headers:c,body:JSON.stringify({wins:i.wins,time:i.time})})})}};a(y,"abortControllers",{});let G=y},514:(x,R,u)=>{u.d(R,{A:()=>b});var C=u(256);function b({className:a,textContent:_="",buttonType:p="button",clickHandler:A}){return new C.A({tag:"button",className:a,textContent:_,type:p,onclick:A})}},180:(x,R,u)=>{u.d(R,{A:()=>c});var C=u(256),b=u(734),a=u(182),_=Object.defineProperty,p=(o,s,g)=>s in o?_(o,s,{enumerable:!0,configurable:!0,writable:!0,value:g}):o[s]=g,A=(o,s,g)=>(p(o,typeof s!="symbol"?s+"":s,g),g);class c extends C.A{constructor(s,g){super({className:"header",tag:"header"}),A(this,"router"),this.getNode().classList.add(`${g}-page__header`),this.router=s;const m=(0,b.h1)("header__title","Async Race"),L=(0,b.a)({className:"header__link button",href:`#${a.Y.GARAGE}`,textContent:"Garage page"}),y=(0,b.a)({className:"header__link button",href:`#${a.Y.WINNERS}`,textContent:"Winners page"}),G=(0,b.C$)({className:"header__nav"},L,y);g===a.Y.GARAGE?(L.getNode().classList.add("button--disabled"),L.getNode().removeAttribute("href")):g===a.Y.WINNERS&&(y.getNode().classList.add("button--disabled"),y.getNode().removeAttribute("href")),this.appendChildren([m,G])}}},756:(x,R,u)=>{u.d(R,{A:()=>A});var C=u(256),b=u(538),a=Object.defineProperty,_=(c,o,s)=>o in c?a(c,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[o]=s,p=(c,o,s)=>(_(c,typeof o!="symbol"?o+"":o,s),s);class A extends C.A{constructor(o,s){super({className:"garage-page__heading heading",tag:"h2",textContent:s}),p(this,"pageName"),p(this,"setPageInfo",g=>{this.getNode().textContent=`${this.pageName} (${g.carsCount})`}),this.pageName=s,o.on(b.A.PAGE_UPDATE,this.setPageInfo)}}},686:(x,R,u)=>{u.d(R,{A:()=>o});var C=u(256),b=u(734),a=u(514),_=u(538),p=Object.defineProperty,A=(s,g,m)=>g in s?p(s,g,{enumerable:!0,configurable:!0,writable:!0,value:m}):s[g]=m,c=(s,g,m)=>(A(s,typeof g!="symbol"?g+"":g,m),m);class o extends C.A{constructor(g){super({className:"pagination",tag:"div"}),c(this,"text"),c(this,"nextPageButton"),c(this,"prevPageButton"),c(this,"isNextButtonDisabled",!1),c(this,"isPrevButtonDisabled",!1),c(this,"onPageUpdate",m=>{this.text.setTextContent(`Page #${m.pageNumber}`),m.pageNumber===1?(this.prevPageButton.setAttribute("disabled",""),this.isPrevButtonDisabled=!0):(this.prevPageButton.removeAttribute("disabled"),this.isPrevButtonDisabled=!1),m.pageNumber===m.pageCount||m.pageCount===0?(this.nextPageButton.setAttribute("disabled",""),this.isNextButtonDisabled=!0):m.pageCount!==0&&m.pageNumber<m.pageCount&&(this.nextPageButton.removeAttribute("disabled"),this.isNextButtonDisabled=!1)}),this.text=(0,b.p)({className:"pagination__page-number",textContent:"Page #"}),this.nextPageButton=(0,a.A)({className:"pagination__button-next button",textContent:"Next page",buttonType:"button"}),this.prevPageButton=(0,a.A)({className:"pagination__button-prev button",textContent:"Prev page",buttonType:"button"}),g.on(_.A.PAGE_UPDATE,this.onPageUpdate),g.on(_.A.RACE_START_CLICK,()=>{this.nextPageButton.setAttribute("disabled",""),this.prevPageButton.setAttribute("disabled","")}),g.on(_.A.RACE_RESET_CLICK,()=>{this.nextPageButton.getNode().disabled=this.isNextButtonDisabled,this.prevPageButton.getNode().disabled=this.isPrevButtonDisabled}),this.nextPageButton.addListener("click",()=>g.emit(_.A.NEXT_PAGE_CLICK)),this.prevPageButton.addListener("click",()=>g.emit(_.A.PREV_PAGE_CLICK)),this.appendChildren([this.text,this.prevPageButton,this.nextPageButton])}}},65:(x,R,u)=>{u.d(R,{A:()=>a});var C=u(383);const a=new C.A},538:(x,R,u)=>{u.d(R,{A:()=>b});var C=(a=>(a.NEXT_PAGE_CLICK="nextPageSwitch",a.PREV_PAGE_CLICK="prevPageSwitch",a.CAR_CREATION_CLICK="carCreation",a.CAR_SELECTION_CLICK="carSelection",a.CAR_UPDATE_CLICK="carUpdate",a.RACE_START_CLICK="raceStart",a.RACE_RESET_CLICK="raceReset",a.CARS_GENERATION_CLICK="carsGeneration",a.CAR_START_CLICK="carStart",a.CAR_RESET_CLICK="carReset",a.CAR_REMOVE_CLICK="carRemove",a.PAGE_UPDATE="pageUpdate",a.TRACKS_REFILL="tracksRefill",a.ALL_CARS_START="allCarsStart",a.ALL_CARS_RESET="allCarsReset",a.CARS_UPDATE="carsUpdate",a.WINNERS_UPDATE="winnersUpdate",a.WINNER_UPDATE="winnerUpdate",a.WINNER_REMOVE="winnerRemove",a.MODAL_SHOW="modalShow",a.ROWS_REFILL="rowsRefill",a.ROWS_SORT="rowsSort",a.CAR_MOVEMENT_VIEW="carMovementView",a.CAR_STOP_VIEW="carStopView",a.CAR_RESET_VIEW="carResetView",a.CAR_SELECTION_VIEW="carSelectionView",a))(C||{});const b=C},384:(x,R,u)=>{u.r(R),u.d(R,{default:()=>xt});var C=u(256),b=u(180),a=u(182),_=u(756),p=u(686),A=u(383),c=u(514),o=u(734),s=u(538),g=Object.defineProperty,m=(n,t,e)=>t in n?g(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,L=(n,t,e)=>(m(n,typeof t!="symbol"?t+"":t,e),e);const y="#aaaaaa";class G extends C.A{constructor(t){super({className:"garage-page__car-creation",tag:"div"}),L(this,"colorInput"),L(this,"nameInput"),L(this,"carCreationButton"),L(this,"isButtonDisabled",!0),L(this,"carPreview"),this.colorInput=(0,o.hF)({className:"garage-page__color-input",type:"color",value:y}),this.nameInput=(0,o.hF)({className:"garage-page__name-input",maxLength:22,placeholder:"Enter car name"}),this.carCreationButton=(0,c.A)({className:"garage-page__create-button button",textContent:"Create car",buttonType:"button"}),this.carPreview=(0,o.y4)({className:"garage-page__car-preview"}),this.carPreview.getNode().style.setProperty("--color-car-preview",y),this.carCreationButton.getNode().disabled=!0,this.addListeners(t),this.appendChildren([this.nameInput,this.colorInput,this.carPreview,this.carCreationButton])}addListeners(t){this.nameInput.addListener("input",()=>{this.carCreationButton.getNode().disabled=!this.nameInput.getNode().value,this.isButtonDisabled=this.carCreationButton.getNode().disabled}),this.colorInput.addListener("input",()=>{this.carPreview.getNode().style.setProperty("--color-car-preview",this.colorInput.getNode().value)}),this.carCreationButton.addListener("click",()=>{const e=this.nameInput.getNode().value,r=this.colorInput.getNode().value;t.emit(s.A.CAR_CREATION_CLICK,{carName:e,carColor:r})}),t.on(s.A.RACE_START_CLICK,()=>{this.carCreationButton.setAttribute("disabled","")}),t.on(s.A.RACE_RESET_CLICK,()=>{this.carCreationButton.getNode().disabled=this.isButtonDisabled})}}var d=Object.defineProperty,i=(n,t,e)=>t in n?d(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,l=(n,t,e)=>(i(n,typeof t!="symbol"?t+"":t,e),e);const E="#aaaaaa";class N extends C.A{constructor(t){super({className:"garage-page__car-update",tag:"div"}),l(this,"emitter"),l(this,"colorInput"),l(this,"nameInput"),l(this,"carUpdateButton"),l(this,"selectedCar",null),l(this,"isButtonDisabled",!0),l(this,"carPreview"),l(this,"onCarSelection",e=>{this.selectedCar=e,this.colorInput.getNode().value=e.color,this.carPreview.getNode().style.setProperty("--color-car-preview",e.color),this.nameInput.getNode().value=e.name,this.colorInput.removeAttribute("disabled"),this.nameInput.removeAttribute("disabled"),this.carUpdateButton.removeAttribute("disabled"),this.isButtonDisabled=this.carUpdateButton.getNode().disabled}),l(this,"onCarUpdate",()=>{this.selectedCar&&(this.selectedCar.color=this.colorInput.getNode().value,this.selectedCar.name=this.nameInput.getNode().value,this.emitter.emit(s.A.CAR_UPDATE_CLICK,this.selectedCar),this.resetFields())}),l(this,"resetFields",()=>{this.selectedCar=null,this.nameInput.getNode().value="",this.colorInput.getNode().value=E,this.carPreview.getNode().style.setProperty("--color-car-preview",E),this.colorInput.setAttribute("disabled",""),this.nameInput.setAttribute("disabled",""),this.carUpdateButton.setAttribute("disabled",""),this.isButtonDisabled=this.carUpdateButton.getNode().disabled}),this.emitter=t,this.colorInput=(0,o.hF)({className:"garage-page__color-input",type:"color",value:E,disabled:!0}),this.nameInput=(0,o.hF)({className:"garage-page__name-input",maxLength:22,placeholder:"Enter car name",disabled:!0}),this.carUpdateButton=(0,c.A)({className:"garage-page__update-button button",textContent:"Update car",buttonType:"button"}),this.carPreview=(0,o.y4)({className:"garage-page__car-preview"}),this.carPreview.getNode().style.setProperty("--color-car-preview",E),this.carUpdateButton.getNode().disabled=!0,this.appendChildren([this.nameInput,this.colorInput,this.carPreview,this.carUpdateButton]),this.addListeners()}addListeners(){this.nameInput.addListener("input",()=>{this.carUpdateButton.getNode().disabled=!this.nameInput.getNode().value,this.isButtonDisabled=this.carUpdateButton.getNode().disabled}),this.carUpdateButton.addListener("click",this.onCarUpdate),this.colorInput.addListener("input",()=>{this.carPreview.getNode().style.setProperty("--color-car-preview",this.colorInput.getNode().value)}),this.emitter.on(s.A.CAR_SELECTION_VIEW,this.onCarSelection),this.emitter.on(s.A.NEXT_PAGE_CLICK,this.resetFields),this.emitter.on(s.A.PREV_PAGE_CLICK,this.resetFields),this.emitter.on(s.A.CAR_REMOVE_CLICK,t=>{var e;t.id===((e=this.selectedCar)==null?void 0:e.id)&&this.resetFields()}),this.emitter.on(s.A.RACE_START_CLICK,()=>{this.carUpdateButton.setAttribute("disabled","")}),this.emitter.on(s.A.RACE_RESET_CLICK,()=>{this.carUpdateButton.getNode().disabled=this.isButtonDisabled})}}var K=Object.defineProperty,V=(n,t,e)=>t in n?K(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,w=(n,t,e)=>(V(n,typeof t!="symbol"?t+"":t,e),e);const O=2e3;class H extends C.A{constructor(t){super({className:"garage-page__race-buttons",tag:"div"}),w(this,"startButton"),w(this,"resetButton"),w(this,"generationButton"),this.startButton=(0,c.A)({className:"garage-page__start-button button button--confirm",textContent:"Start race",buttonType:"button"}),this.resetButton=(0,c.A)({className:"garage-page__reset-button button button--cancel",textContent:"Reset race",buttonType:"button"}),this.generationButton=(0,c.A)({className:"garage-page__random-create-button button button--continue",textContent:"Generate cars",buttonType:"button"}),this.resetButton.setAttribute("disabled",""),this.appendChildren([this.startButton,this.resetButton,this.generationButton]),this.addListeners(t)}addListeners(t){this.startButton.addListener("click",()=>{t.emit(s.A.RACE_START_CLICK),this.startButton.setAttribute("disabled",""),this.generationButton.setAttribute("disabled",""),setTimeout(()=>{this.resetButton.removeAttribute("disabled")},O)}),this.resetButton.addListener("click",()=>{t.emit(s.A.RACE_RESET_CLICK),this.generationButton.removeAttribute("disabled"),this.resetButton.setAttribute("disabled",""),setTimeout(()=>{this.startButton.removeAttribute("disabled")},O)}),this.generationButton.addListener("click",()=>{t.emit(s.A.CARS_GENERATION_CLICK)})}}var W=u(837);const z=["Toyota","Honda","Ford","BMW","Mercedes","Chevrolet","Audi","Volkswagen","Hyundai","Nissan"],Z=["Corolla","Camry","RAV4","Civic","Accord","CR-V","F-150","Focus","Mustang","3 Series","5 Series","X5","C-Class","E-Class","S-Class","Cruze","Malibu","Silverado","A4","A6","Q7","Golf","Passat","Tiguan","Elantra","Sonata","Santa Fe","Altima","Maxima","Rogue"],nt=()=>{const n=z[Math.floor(Math.random()*z.length)],t=Z[Math.floor(Math.random()*Z.length)];return`${n} ${t}`},st=()=>{const t=I=>I.toString(16).padStart(2,"0"),e=Math.floor(Math.random()*256),r=Math.floor(Math.random()*256),h=Math.floor(Math.random()*256);return`#${t(e)}${t(r)}${t(h)}`},rt=()=>({name:nt(),color:st()});function at(n){return Array.from({length:n},rt)}var it=Object.defineProperty,ot=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable,J=(n,t,e)=>t in n?it(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,dt=(n,t)=>{for(var e in t||(t={}))lt.call(t,e)&&J(n,e,t[e]);if(j)for(var e of j(t))ut.call(t,e)&&J(n,e,t[e]);return n},ht=(n,t)=>ot(n,ct(t)),f=(n,t,e)=>(J(n,typeof t!="symbol"?t+"":t,e),e),$=(n,t,e)=>new Promise((r,h)=>{var I=P=>{try{U(e.next(P))}catch(M){h(M)}},B=P=>{try{U(e.throw(P))}catch(M){h(M)}},U=P=>P.done?r(P.value):Promise.resolve(P.value).then(I,B);U((e=e.apply(n,t)).next())});const q=7,pt=100,_t=1e3;class k{constructor(){f(this,"currentPage",1),f(this,"pageCount",1),f(this,"pageCars",[]),f(this,"movingCars",[]),f(this,"raceWinner",null),f(this,"isRaceInProgress",!1),f(this,"winnersTime",""),f(this,"getPageCars",()=>this.pageCars),f(this,"getRaceStatus",()=>this.isRaceInProgress&&this.movingCars.length>0),f(this,"getWinner",()=>this.raceWinner),f(this,"getWinnersTime",()=>this.winnersTime),f(this,"onRaceStart",()=>{this.isRaceInProgress=!0,this.raceWinner=null}),f(this,"onRaceEnd",()=>{this.isRaceInProgress=!1,this.movingCars=[]}),f(this,"onNextPage",()=>{this.currentPage<this.pageCount&&(this.currentPage+=1)}),f(this,"onPrevPage",()=>{this.currentPage>1&&(this.currentPage-=1)}),f(this,"onCarMovementEnd",t=>{this.movingCars=this.movingCars.filter(e=>e!==t),this.movingCars.length===0&&this.onRaceEnd()})}onCarStart(t){return $(this,null,function*(){const e=yield W.Ay.startEngine(t.id);return this.movingCars.push(t),e})}onCarStop(t){return $(this,null,function*(){yield W.Ay.stopEngine(t.id),this.onCarMovementEnd(t)})}onCarDrive(t){return $(this,null,function*(){const e=new Date,r=yield W.Ay.isDriveSuccessful(t.id),h=new Date;return r?this.getRaceStatus()&&!this.raceWinner?(this.winnersTime=((h.getTime()-e.getTime())/_t).toFixed(2),this.raceWinner=t,!0):(this.onCarMovementEnd(t),!0):(this.onCarMovementEnd(t),!1)})}getPageInfo(){return $(this,null,function*(){const t=yield W.Ay.getCars(this.currentPage,q);return this.pageCars=t.cars,t.totalCount&&(this.pageCount=Math.ceil(+t.totalCount/q)),ht(dt({},t),{currentPage:this.currentPage,pageCount:this.pageCount})})}static createCar(t){return $(this,null,function*(){yield W.Ay.createCar(t.carName,t.carColor)})}static createCars(){return $(this,null,function*(){const e=at(pt).map(r=>W.Ay.createCar(r.name,r.color));yield Promise.all(e)})}static deleteCar(t){return $(this,null,function*(){yield W.Ay.deleteCar(t.id)})}static updateCar(t){return $(this,null,function*(){yield W.Ay.updateCar(t)})}}var Q=u(65),gt=Object.defineProperty,Ct=(n,t,e)=>t in n?gt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,T=(n,t,e)=>(Ct(n,typeof t!="symbol"?t+"":t,e),e),D=(n,t,e)=>new Promise((r,h)=>{var I=P=>{try{U(e.next(P))}catch(M){h(M)}},B=P=>{try{U(e.throw(P))}catch(M){h(M)}},U=P=>P.done?r(P.value):Promise.resolve(P.value).then(I,B);U((e=e.apply(n,t)).next())});class At{constructor(t,e){T(this,"emitter"),T(this,"state"),T(this,"onCarStart",r=>D(this,null,function*(){const h=yield this.state.onCarStart(r);this.emitter.emit(s.A.CAR_MOVEMENT_VIEW,{car:r,engineResponse:h});const I=yield this.state.onCarDrive(r),B=this.state.getWinner();I&&B&&B.id===r.id&&this.state.getRaceStatus()&&(this.emitter.emit(s.A.MODAL_SHOW,{winnerName:B.name,winnerTime:this.state.getWinnersTime()}),Q.A.emit(s.A.WINNER_UPDATE,{car:B,finishTime:parseFloat(this.state.getWinnersTime())}),this.state.onRaceEnd()),I||this.emitter.emit(s.A.CAR_STOP_VIEW,r)})),T(this,"onCarsUpdate",()=>D(this,null,function*(){const r=yield this.state.getPageInfo();this.emitter.emit(s.A.TRACKS_REFILL,r.cars),this.emitter.emit(s.A.PAGE_UPDATE,{carsCount:r.totalCount,pageNumber:r.currentPage,pageCount:r.pageCount})})),T(this,"onNextPage",()=>D(this,null,function*(){this.state.onNextPage(),yield this.onCarsUpdate()})),T(this,"onPrevPage",()=>D(this,null,function*(){this.state.onPrevPage(),yield this.onCarsUpdate()})),T(this,"onCarUpdate",r=>D(this,null,function*(){Q.A.emit(s.A.WINNER_UPDATE,{car:r}),yield k.updateCar(r),yield this.onCarsUpdate()})),T(this,"onCarCreation",r=>D(this,null,function*(){yield k.createCar(r),yield this.onCarsUpdate()})),T(this,"onCarsGeneration",()=>D(this,null,function*(){yield k.createCars(),yield this.onCarsUpdate()})),T(this,"onCarReset",r=>D(this,null,function*(){yield this.state.onCarStop(r),this.emitter.emit(s.A.CAR_RESET_VIEW,r.id)})),T(this,"onCarSelection",r=>{this.emitter.emit(s.A.CAR_SELECTION_VIEW,r)}),T(this,"onRaceStart",()=>{this.onRaceReset(),this.state.onRaceStart(),this.emitter.emit(s.A.ALL_CARS_START)}),T(this,"onRaceReset",()=>{this.state.onRaceEnd(),this.emitter.emit(s.A.ALL_CARS_RESET)}),T(this,"onCarRemove",r=>D(this,null,function*(){yield k.deleteCar(r),Q.A.emit(s.A.WINNER_REMOVE,r.id);const h=yield this.state.getPageInfo();h.cars.length===0&&h.currentPage>1?yield this.onPrevPage():(this.emitter.emit(s.A.TRACKS_REFILL,h.cars),this.emitter.emit(s.A.PAGE_UPDATE,{carsCount:h.totalCount,pageNumber:h.currentPage}))})),this.emitter=t,this.state=e,t.on(s.A.RACE_START_CLICK,this.onRaceStart),t.on(s.A.RACE_RESET_CLICK,this.onRaceReset),t.on(s.A.CAR_CREATION_CLICK,this.onCarCreation),t.on(s.A.CAR_SELECTION_CLICK,this.onCarSelection),t.on(s.A.CAR_UPDATE_CLICK,this.onCarUpdate),t.on(s.A.CAR_REMOVE_CLICK,this.onCarRemove),t.on(s.A.CARS_GENERATION_CLICK,this.onCarsGeneration),t.on(s.A.CAR_START_CLICK,this.onCarStart),t.on(s.A.CAR_RESET_CLICK,this.onCarReset),t.on(s.A.NEXT_PAGE_CLICK,this.onNextPage),t.on(s.A.PREV_PAGE_CLICK,this.onPrevPage),t.on(s.A.CARS_UPDATE,this.onCarsUpdate),t.emit(s.A.CARS_UPDATE)}}var mt=Object.defineProperty,bt=(n,t,e)=>t in n?mt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,Y=(n,t,e)=>(bt(n,typeof t!="symbol"?t+"":t,e),e);class Et extends C.A{constructor(t,e){super({className:"garage-page__track-buttons",tag:"div"}),Y(this,"startButton"),Y(this,"resetButton"),Y(this,"selectButton"),Y(this,"removeButton"),this.startButton=(0,c.A)({className:"garage-page__button-car-start button button--confirm",textContent:"Start",buttonType:"button"}),this.resetButton=(0,c.A)({className:"garage-page__button-car-reset button button--cancel",textContent:"Reset",buttonType:"button"}),this.selectButton=(0,c.A)({className:"garage-page__button-car-select button button--continue",textContent:"Select",buttonType:"button"}),this.removeButton=(0,c.A)({className:"garage-page__button-car-remove button button--cancel",textContent:"Remove",buttonType:"button"}),this.resetButton.setAttribute("disabled",""),this.appendChildren([this.startButton,this.resetButton,this.selectButton,this.removeButton]),this.addListeners(t,e)}addListeners(t,e){this.startButton.addListener("click",()=>{t.emit(s.A.CAR_START_CLICK,e),this.startButton.setAttribute("disabled","")}),this.resetButton.addListener("click",()=>{t.emit(s.A.CAR_RESET_CLICK,e),this.resetButton.setAttribute("disabled","")}),this.selectButton.addListener("click",()=>{t.emit(s.A.CAR_SELECTION_CLICK,e)}),this.removeButton.addListener("click",()=>t.emit(s.A.CAR_REMOVE_CLICK,e)),t.on(s.A.CAR_MOVEMENT_VIEW,({car:r})=>{e.id===r.id&&this.resetButton.removeAttribute("disabled")}),t.on(s.A.CAR_RESET_VIEW,r=>{e.id===r&&this.startButton.removeAttribute("disabled")}),t.on(s.A.RACE_START_CLICK,()=>{this.selectButton.setAttribute("disabled",""),this.removeButton.setAttribute("disabled","")}),t.on(s.A.RACE_RESET_CLICK,()=>{this.selectButton.removeAttribute("disabled"),this.removeButton.removeAttribute("disabled")})}clickStartButton(){this.startButton.getNode().click()}clickResetButton(){this.resetButton.getNode().click()}}var Rt=Object.defineProperty,Pt=(n,t,e)=>t in n?Rt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,S=(n,t,e)=>(Pt(n,typeof t!="symbol"?t+"":t,e),e);const tt=16;class ft extends C.A{constructor(t,e){super({className:"garage-page__track",tag:"div"}),S(this,"track"),S(this,"trackName"),S(this,"trackCar"),S(this,"intervalId",0),S(this,"trackButtons"),S(this,"getCar",()=>this.trackCar),S(this,"clickStartButton",()=>{this.trackButtons.clickStartButton()}),S(this,"clickResetButton",()=>{this.trackButtons.clickResetButton()}),S(this,"updateCar",h=>{this.trackName.setTextContent(h.name),this.track.getNode().style.setProperty("--color-car",h.color)}),S(this,"moveCar",h=>{if(this.intervalId||this.trackCar.id!==h.car.id)return;let I=0;this.track.setAttribute("max",h.engineResponse.distance.toString());const B=()=>{I+=h.engineResponse.velocity*tt,I<=h.engineResponse.distance?this.track.setAttribute("value",I.toString()):(this.track.setAttribute("value",h.engineResponse.distance.toString()),this.clearInterval())};this.intervalId=Number(setInterval(B,tt))}),S(this,"clearInterval",()=>{this.intervalId&&(clearInterval(this.intervalId),this.intervalId=0)}),S(this,"stopCar",h=>{this.trackCar.id===h.id&&(this.clearInterval(),this.track.addClass("garage-page__track-input--broken"))}),S(this,"resetCar",h=>{this.trackCar.id===h&&(this.clearInterval(),this.track.setAttribute("value","0"),this.track.removeClass("garage-page__track-input--broken"))}),this.trackCar=e,this.trackName=(0,o.p)({className:"garage-page__track-name",textContent:""}),this.track=(0,o.hF)({className:"garage-page__track-input",type:"range",max:"100"}),this.track.setAttribute("value","0"),this.trackButtons=new Et(t,e);const r=(0,o.y4)({className:"garage-page__track-container"},this.track);this.appendChildren([this.trackName,this.trackButtons,r]),t.on(s.A.CAR_MOVEMENT_VIEW,this.moveCar),t.on(s.A.CAR_STOP_VIEW,this.stopCar),t.on(s.A.CAR_RESET_VIEW,this.resetCar)}}var vt=Object.defineProperty,Tt=(n,t,e)=>t in n?vt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,X=(n,t,e)=>(Tt(n,typeof t!="symbol"?t+"":t,e),e);class It extends C.A{constructor(t){super({className:"garage-page__race-tracks",tag:"div"}),X(this,"emitter"),X(this,"tracks",[]),X(this,"onTracksRefill",e=>{this.tracks=e.map(r=>{const h=new ft(this.emitter,r);return h.updateCar(r),h}),this.removeChildren(),this.appendChildren(this.tracks)}),X(this,"onAllCarsStart",()=>{this.tracks.forEach(e=>{e.clickStartButton()})}),X(this,"onAllCarsReset",()=>{this.tracks.forEach(e=>{e.clickResetButton()})}),this.emitter=t,t.on(s.A.TRACKS_REFILL,this.onTracksRefill),t.on(s.A.ALL_CARS_START,this.onAllCarsStart),t.on(s.A.ALL_CARS_RESET,this.onAllCarsReset)}}var Nt=Object.defineProperty,St=(n,t,e)=>t in n?Nt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,F=(n,t,e)=>(St(n,typeof t!="symbol"?t+"":t,e),e);const Lt=600;class Bt extends C.A{constructor(t){super({className:"modal modal--closed"}),F(this,"confirmButton"),F(this,"contentComponent"),F(this,"description"),F(this,"onWinnerFinish",({winnerName:e,winnerTime:r})=>{this.description.setTextContent(`${e} wins in ${r}\xA0sec`),this.showModal()}),F(this,"showModal",()=>{this.addClass("modal--opaque"),this.confirmButton.getNode().focus(),this.removeClass("modal--closed")}),F(this,"closeModal",()=>{this.removeClass("modal--opaque"),setTimeout(()=>{this.addClass("modal--closed")},Lt)}),F(this,"onDocumentEscapeKeydown",e=>{e.key==="Escape"&&this.closeModal()}),F(this,"onModalClick",e=>{e.composedPath().includes(this.contentComponent.getNode())||this.closeModal()}),this.description=(0,o.h2)("modal__description",""),this.confirmButton=(0,c.A)({className:"modal__button button",textContent:"OK",buttonType:"button",clickHandler:this.closeModal}),this.contentComponent=(0,o.y4)({className:"modal__content"},this.description,this.confirmButton),this.append(this.contentComponent),document.addEventListener("keydown",this.onDocumentEscapeKeydown),this.getNode().addEventListener("click",this.onModalClick),t.on(s.A.MODAL_SHOW,this.onWinnerFinish)}}var Ot=Object.defineProperty,yt=(n,t,e)=>t in n?Ot(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,et=(n,t,e)=>(yt(n,typeof t!="symbol"?t+"":t,e),e);class wt extends C.A{constructor(){super({className:"garage-page__main main",tag:"main"}),et(this,"emitter"),et(this,"controller"),this.emitter=new A.A;const t=new k;this.controller=new At(this.emitter,t);const e=a.Y.GARAGE.charAt(0).toUpperCase()+a.Y.GARAGE.slice(1),r=new _.A(this.emitter,e),h=new G(this.emitter),I=new N(this.emitter),B=new H(this.emitter),U=new p.A(this.emitter),P=new It(this.emitter),M=new Bt(this.emitter);this.appendChildren([r,h,I,B,U,P,M])}}var Dt=Object.defineProperty,Ut=(n,t,e)=>t in n?Dt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,Mt=(n,t,e)=>(Ut(n,typeof t!="symbol"?t+"":t,e),e);class xt extends C.A{constructor(t){super({className:"app-container__page garage-page"}),Mt(this,"router"),this.router=t;const e=new b.A(t,a.Y.GARAGE),r=new wt;this.appendChildren([e,r])}}},383:(x,R,u)=>{u.d(R,{A:()=>_});var C=Object.defineProperty,b=(p,A,c)=>A in p?C(p,A,{enumerable:!0,configurable:!0,writable:!0,value:c}):p[A]=c,a=(p,A,c)=>(b(p,typeof A!="symbol"?A+"":A,c),c);class _{constructor(){a(this,"handlers",{})}on(A,c){const o=this.handlers[A]||[];o.length===0&&(this.handlers[A]=o),o.push(c)}off(A,c){const o=this.handlers[A];if(o)for(let s=0;s<o.length;s+=1)o[s]===c&&o.splice(s-=1,1)}emit(A,c){const o=this.handlers[A];o&&o.forEach(s=>s(c))}}}}]);
