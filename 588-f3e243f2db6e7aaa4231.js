"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[588],{837:(y,w,u)=>{u.d(w,{Ay:()=>K,gx:()=>A,xB:()=>O});var E=Object.defineProperty,C=(d,i,c)=>i in d?E(d,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):d[i]=c,s=(d,i,c)=>(C(d,typeof i!="symbol"?i+"":i,c),c),g=(d,i,c)=>new Promise((m,T)=>{var L=N=>{try{D(c.next(N))}catch($){T($)}},M=N=>{try{D(c.throw(N))}catch($){T($)}},D=N=>N.done?m(N.value):Promise.resolve(N.value).then(L,M);D((c=c.apply(d,i)).next())});const p="http://127.0.0.1:3000",f=200,o={"Content-Type":"application/json"};var l=(d=>(d.GET="GET",d.POST="POST",d.PUT="PUT",d.DELETE="DELETE",d.PATCH="PATCH",d))(l||{}),r=(d=>(d.GARAGE="garage",d.ENGINE="engine",d.WINNERS="winners",d))(r||{}),P=(d=>(d.STARTED="started",d.STOPPED="stopped",d.DRIVE="drive",d))(P||{}),A=(d=>(d.ID="id",d.WINS="wins",d.TIME="time",d))(A||{}),O=(d=>(d.ASC="ASC",d.DESC="DESC",d))(O||{});const x=class R{static getFetchResponse(i,c){return g(this,null,function*(){return yield fetch(i,c)})}static getCars(i,c){return g(this,null,function*(){const m=yield R.getFetchResponse(`${p}/garage?_page=${i!=null?i:""}&_limit=${c!=null?c:""}`),T=yield m.json(),L=m.headers.get("X-Total-Count");return{cars:T,totalCount:L}})}static getCar(i){return g(this,null,function*(){return(yield R.getFetchResponse(`${p}/garage/${i}`)).json()})}static createCar(i,c){return g(this,null,function*(){yield R.getFetchResponse(`${p}/garage`,{method:"POST",headers:o,body:JSON.stringify({name:i,color:c})})})}static deleteCar(i){return g(this,null,function*(){yield R.getFetchResponse(`${p}/garage/${i}`,{method:"DELETE"})})}static updateCar(i){return g(this,null,function*(){yield R.getFetchResponse(`${p}/garage/${i.id}`,{method:"PUT",headers:o,body:JSON.stringify({name:i.name,color:i.color})})})}static startEngine(i){return g(this,null,function*(){return(yield R.getFetchResponse(`${p}/engine?id=${i}&status=started`,{method:"PATCH"})).json()})}static stopEngine(i){return g(this,null,function*(){const c=R.abortControllers[i];c&&(c.abort(),delete R.abortControllers[i]),yield R.getFetchResponse(`${p}/engine?id=${i}&status=stopped`,{method:"PATCH"})})}static isDriveSuccessful(i){return g(this,null,function*(){const c=new AbortController;let m;R.abortControllers[i]=c;try{m=yield R.getFetchResponse(`${p}/engine?id=${i}&status=drive`,{method:"PATCH",signal:c.signal})}catch(T){if(T instanceof Error&&T.name!=="AbortError")throw T}return m?m.status===f:!1})}static getWinners(i,c,m,T){return g(this,null,function*(){const L=yield R.getFetchResponse(`${p}/winners?_page=${i!=null?i:""}&_limit=${c!=null?c:""}&_sort=${m!=null?m:""}&_order=${T!=null?T:""}`),M=yield L.json(),D=L.headers.get("X-Total-Count");return{winners:M,totalCount:D}})}static getWinner(i){return g(this,null,function*(){return(yield fetch(`${p}/winners/${i}`)).json()})}static createWinner(i,c,m){return g(this,null,function*(){yield R.getFetchResponse(`${p}/winners`,{method:"POST",headers:o,body:JSON.stringify({id:i,wins:c,time:m})})})}static deleteWinner(i){return g(this,null,function*(){yield R.getFetchResponse(`${p}/winners/${i}`,{method:"DELETE"})})}static updateWinner(i){return g(this,null,function*(){yield R.getFetchResponse(`${p}/winners/${i.id}`,{method:"PUT",headers:o,body:JSON.stringify({wins:i.wins,time:i.time})})})}};s(x,"abortControllers",{});let K=x},514:(y,w,u)=>{u.d(w,{A:()=>C});var E=u(256);function C({className:s,textContent:g="",buttonType:p="button",clickHandler:f}){return new E.A({tag:"button",className:s,textContent:g,type:p,onclick:f})}},180:(y,w,u)=>{u.d(w,{A:()=>o});var E=u(256),C=u(734),s=u(182),g=Object.defineProperty,p=(l,r,P)=>r in l?g(l,r,{enumerable:!0,configurable:!0,writable:!0,value:P}):l[r]=P,f=(l,r,P)=>(p(l,typeof r!="symbol"?r+"":r,P),P);class o extends E.A{constructor(r,P){super({className:"header",tag:"header"}),f(this,"router"),this.getNode().classList.add(`${P}-page__header`),this.router=r;const A=(0,C.h1)("header__title","Async Race"),O=(0,C.a)({className:"header__link button",href:`#${s.Y.GARAGE}`,textContent:"Garage page"}),x=(0,C.a)({className:"header__link button",href:`#${s.Y.WINNERS}`,textContent:"Winners page"}),K=(0,C.C$)({className:"header__nav"},O,x);P===s.Y.GARAGE?(O.getNode().classList.add("button--disabled"),O.getNode().removeAttribute("href")):P===s.Y.WINNERS&&(x.getNode().classList.add("button--disabled"),x.getNode().removeAttribute("href")),this.appendChildren([A,K])}}},756:(y,w,u)=>{u.d(w,{A:()=>f});var E=u(256),C=u(538),s=Object.defineProperty,g=(o,l,r)=>l in o?s(o,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[l]=r,p=(o,l,r)=>(g(o,typeof l!="symbol"?l+"":l,r),r);class f extends E.A{constructor(l,r){super({className:"garage-page__heading heading",tag:"h2",textContent:r}),p(this,"pageName"),p(this,"setPageInfo",P=>{this.getNode().textContent=`${this.pageName} (${P.carsCount})`}),this.pageName=r,l.on(C.A.PAGE_UPDATE,this.setPageInfo)}}},686:(y,w,u)=>{u.d(w,{A:()=>l});var E=u(256),C=u(734),s=u(514),g=u(538),p=Object.defineProperty,f=(r,P,A)=>P in r?p(r,P,{enumerable:!0,configurable:!0,writable:!0,value:A}):r[P]=A,o=(r,P,A)=>(f(r,typeof P!="symbol"?P+"":P,A),A);class l extends E.A{constructor(P){super({className:"pagination",tag:"div"}),o(this,"text"),o(this,"nextPageButton"),o(this,"prevPageButton"),o(this,"isNextButtonDisabled",!1),o(this,"isPrevButtonDisabled",!1),o(this,"onPageUpdate",A=>{this.text.setTextContent(`Page #${A.pageNumber}`),A.pageNumber===1?(this.prevPageButton.setAttribute("disabled",""),this.isPrevButtonDisabled=!0):(this.prevPageButton.removeAttribute("disabled"),this.isPrevButtonDisabled=!1),A.pageNumber===A.pageCount||A.pageCount===0?(this.nextPageButton.setAttribute("disabled",""),this.isNextButtonDisabled=!0):A.pageCount!==0&&A.pageNumber<A.pageCount&&(this.nextPageButton.removeAttribute("disabled"),this.isNextButtonDisabled=!1)}),this.text=(0,C.p)({className:"pagination__page-number",textContent:"Page #"}),this.nextPageButton=(0,s.A)({className:"pagination__button-next button",textContent:"Next page",buttonType:"button"}),this.prevPageButton=(0,s.A)({className:"pagination__button-prev button",textContent:"Prev page",buttonType:"button"}),P.on(g.A.PAGE_UPDATE,this.onPageUpdate),P.on(g.A.RACE_START_CLICK,()=>{this.nextPageButton.setAttribute("disabled",""),this.prevPageButton.setAttribute("disabled","")}),P.on(g.A.RACE_RESET_CLICK,()=>{this.nextPageButton.getNode().disabled=this.isNextButtonDisabled,this.prevPageButton.getNode().disabled=this.isPrevButtonDisabled}),this.nextPageButton.addListener("click",()=>P.emit(g.A.NEXT_PAGE_CLICK)),this.prevPageButton.addListener("click",()=>P.emit(g.A.PREV_PAGE_CLICK)),this.appendChildren([this.text,this.prevPageButton,this.nextPageButton])}}},65:(y,w,u)=>{u.d(w,{A:()=>s});var E=u(383);const s=new E.A},538:(y,w,u)=>{u.d(w,{A:()=>C});var E=(s=>(s.NEXT_PAGE_CLICK="nextPageSwitch",s.PREV_PAGE_CLICK="prevPageSwitch",s.CAR_CREATION_CLICK="carCreation",s.CAR_SELECTION_CLICK="carSelection",s.CAR_UPDATE_CLICK="carUpdate",s.RACE_START_CLICK="raceStart",s.RACE_RESET_CLICK="raceReset",s.CARS_GENERATION_CLICK="carsGeneration",s.CAR_START_CLICK="carStart",s.CAR_RESET_CLICK="carReset",s.CAR_REMOVE_CLICK="carRemove",s.PAGE_UPDATE="pageUpdate",s.TRACKS_REFILL="tracksRefill",s.ALL_CARS_START="allCarsStart",s.ALL_CARS_RESET="allCarsReset",s.CARS_UPDATE="carsUpdate",s.WINNERS_UPDATE="winnersUpdate",s.WINNER_UPDATE="winnerUpdate",s.WINNER_REMOVE="winnerRemove",s.MODAL_SHOW="modalShow",s.ROWS_REFILL="rowsRefill",s.ROWS_SORT="rowsSort",s.CAR_MOVEMENT_VIEW="carMovementView",s.CAR_STOP_VIEW="carStopView",s.CAR_RESET_VIEW="carResetView",s.CAR_SELECTION_VIEW="carSelectionView",s))(E||{});const C=E},588:(y,w,u)=>{u.r(w),u.d(w,{default:()=>re});var E=u(256),C=u(180),s=u(182),g=u(756),p=u(686),f=u(383),o=u(837),l=u(734),r=u(538);function P(n){if(n===void 0)throw new Error("Value not defined");if(n===null)throw new Error("Value is null")}function A(n){return n!=null}function O(n,e){if(P(n),!(n instanceof e))throw new TypeError("Wrong object type")}const x=(n,e,t)=>{const _=n.querySelector(e);return O(_,t),_},K=(n,e)=>{const{target:t}=n;return t instanceof HTMLElement?t.closest(e):null};var d=Object.defineProperty,i=(n,e,t)=>e in n?d(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,c=(n,e,t)=>(i(n,typeof e!="symbol"?e+"":e,t),t);const m=["\u2116","Car","Name","Wins",`Time,
sec`];class T extends E.A{constructor(e){super({className:"winners-page__table",tag:"table"}),c(this,"emitter"),c(this,"head"),c(this,"body"),c(this,"sortElements",[]),c(this,"pageNumber",1),c(this,"createBodyRows",a=>a.map((h,U)=>{const v=(0,l.td)({className:"winners-page__image-container"}),b=(0,l.td)({textContent:(U+1+(this.pageNumber-1)*10).toString(),className:"winners-page__row-number"}),W=(0,l.td)({textContent:h.name,className:"winners-page__car-name"}),se=(0,l.td)({textContent:h.wins.toString(),className:"winners-page__wins-count"}),ie=(0,l.td)({textContent:h.time.toString(),className:"winners-page__time"});return v.getNode().style.setProperty("--color-car",h.color),(0,l.tr)({className:"winners-page__table-row"},b,v,W,se,ie)})),c(this,"refillTable",a=>{const h=this.createBodyRows(a);this.body.removeChildren(),this.body.appendChildren(h)}),c(this,"handleArrowNearSortElement",a=>{a.classList.contains("winners-page__sort-element--active")?a.classList.toggle("winners-page__sort-element--arrow-up"):(a.classList.toggle("winners-page__sort-element--active"),this.sortElements.forEach(h=>{h!==a&&h.classList.contains("winners-page__sort-element--active")&&(h.classList.contains("winners-page__sort-element--arrow-up")||a.classList.add("winners-page__sort-element--arrow-up"),h.classList.remove("winners-page__sort-element--active"),h.classList.remove("winners-page__sort-element--arrow-up"))}))}),c(this,"onHeadClick",a=>{const h=K(a,".winners-page__sort-element");h&&(h.classList.contains("winners-page__wins-count")?this.emitter.emit(r.A.ROWS_SORT,o.gx.WINS):h.classList.contains("winners-page__time")&&this.emitter.emit(r.A.ROWS_SORT,o.gx.TIME),this.handleArrowNearSortElement(h))}),this.emitter=e;const t=m.map(a=>{const h=(0,l.th)({className:"winners-page__table-head-element",textContent:a});if(a===m[3]||a===m[4]){const U=(0,l.p)({textContent:a,className:"winners-page__sort-content"});h.setTextContent(""),h.append(U),h.addClass("winners-page__sort-element"),this.sortElements.push(h.getNode()),a===m[3]?h.addClass("winners-page__wins-count"):a===m[4]&&h.addClass("winners-page__time")}return h}),_=(0,l.tr)({className:"winners-page__table-head-row"},...t);this.head=(0,l.VQ)({className:"winners-page__table-head"},_),this.body=(0,l.T_)({className:"winners-page__table-body"}),this.appendChildren([this.head,this.body]),this.head.addListener("click",this.onHeadClick),e.on(r.A.PAGE_UPDATE,({pageNumber:a})=>{this.pageNumber=a}),e.on(r.A.ROWS_REFILL,this.refillTable)}}var L=Object.defineProperty,M=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,$=(n,e,t)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,H=(n,e)=>{for(var t in e||(e={}))D.call(e,t)&&$(n,t,e[t]);if(M)for(var t of M(e))N.call(e,t)&&$(n,t,e[t]);return n},S=(n,e,t)=>($(n,typeof e!="symbol"?e+"":e,t),t),G=(n,e,t)=>new Promise((_,a)=>{var h=b=>{try{v(t.next(b))}catch(W){a(W)}},U=b=>{try{v(t.throw(b))}catch(W){a(W)}},v=b=>b.done?_(b.value):Promise.resolve(b.value).then(h,U);v((t=t.apply(n,e)).next())});const X=10,B=class{constructor(){S(this,"currentPage",1),S(this,"pageCount",1),S(this,"winnersCount",0),S(this,"sortBy",o.gx.TIME),S(this,"sortOrder",o.xB.ASC),S(this,"onNextPage",()=>{this.currentPage<this.pageCount&&(this.currentPage+=1)}),S(this,"onPrevPage",()=>{this.currentPage>1&&(this.currentPage-=1)}),S(this,"onSortTypeChange",e=>{this.sortBy=e,this.sortOrder=this.sortOrder===o.xB.ASC?o.xB.DESC:o.xB.ASC}),S(this,"getWinners",()=>G(this,null,function*(){const e=yield o.Ay.getWinners(this.currentPage,X,this.sortBy,this.sortOrder);if(!e.totalCount)throw new Error("Winners not found");this.winnersCount=+e.totalCount,this.pageCount=Math.ceil(+e.totalCount/X);const t=yield Promise.all(e.winners.map(a=>o.Ay.getCar(a.id)));return{winners:e.winners.map((a,h)=>H(H({},a),t[h])),winnersCount:this.winnersCount,currentPage:this.currentPage,pageCount:this.pageCount}}))}static getWinner(e){return G(this,null,function*(){return yield o.Ay.getWinner(e)})}};S(B,"createWinner",(n,e,t)=>G(B,null,function*(){yield o.Ay.createWinner(n,e,t)})),S(B,"deleteWinner",n=>G(B,null,function*(){yield o.Ay.deleteWinner(n)})),S(B,"updateWinner",n=>G(B,null,function*(){yield o.Ay.updateWinner(n)}));let V=B;var Y=u(65),Q=Object.defineProperty,j=(n,e,t)=>e in n?Q(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,I=(n,e,t)=>(j(n,typeof e!="symbol"?e+"":e,t),t),F=(n,e,t)=>new Promise((_,a)=>{var h=b=>{try{v(t.next(b))}catch(W){a(W)}},U=b=>{try{v(t.throw(b))}catch(W){a(W)}},v=b=>b.done?_(b.value):Promise.resolve(b.value).then(h,U);v((t=t.apply(n,e)).next())});class z{constructor(e,t){I(this,"emitter"),I(this,"state"),I(this,"getWinners",()=>F(this,null,function*(){const _=yield this.state.getWinners();_&&(this.emitter.emit(r.A.PAGE_UPDATE,{carsCount:_.winnersCount,pageNumber:_.currentPage,pageCount:_.pageCount}),this.emitter.emit(r.A.ROWS_REFILL,_.winners))})),I(this,"onNextPage",()=>F(this,null,function*(){this.state.onNextPage(),yield this.getWinners()})),I(this,"onPrevPage",()=>F(this,null,function*(){this.state.onPrevPage(),yield this.getWinners()})),I(this,"onRowsSort",_=>F(this,null,function*(){this.state.onSortTypeChange(_),yield this.getWinners()})),I(this,"onWinnerRemove",_=>F(this,null,function*(){yield V.deleteWinner(_);const a=yield this.state.getWinners();a.winners.length===0&&a.currentPage>1?yield this.onPrevPage():(this.emitter.emit(r.A.PAGE_UPDATE,{carsCount:a.winnersCount,pageNumber:a.currentPage}),this.emitter.emit(r.A.ROWS_REFILL,a.winners))})),I(this,"onWinnerUpdate",_=>F(this,null,function*(){const a=yield V.getWinner(_.car.id);Object.keys(a).length!==0?(yield V.updateWinner({id:a.id,wins:(_.finishTime?+a.wins+1:a.wins).toString(),time:(_.finishTime?Math.min(+a.time,_.finishTime):a.time).toString()}),yield this.getWinners()):_.finishTime&&(yield V.createWinner(_.car.id,1,_.finishTime),yield this.getWinners())})),this.emitter=e,this.state=t,e.on(r.A.ROWS_SORT,this.onRowsSort),e.on(r.A.NEXT_PAGE_CLICK,this.onNextPage),e.on(r.A.PREV_PAGE_CLICK,this.onPrevPage),e.on(r.A.WINNERS_UPDATE,this.getWinners),Y.A.on(r.A.WINNER_UPDATE,this.onWinnerUpdate),Y.A.on(r.A.WINNER_REMOVE,this.onWinnerRemove),e.emit(r.A.WINNERS_UPDATE)}}var Z=Object.defineProperty,q=(n,e,t)=>e in n?Z(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,J=(n,e,t)=>(q(n,typeof e!="symbol"?e+"":e,t),t);class k extends E.A{constructor(){super({className:"winners-page__main main",tag:"main"}),J(this,"emitter"),J(this,"controller"),this.emitter=new f.A;const e=new V;this.controller=new z(this.emitter,e);const t=s.Y.WINNERS.charAt(0).toUpperCase()+s.Y.WINNERS.slice(1),_=new g.A(this.emitter,t),a=new p.A(this.emitter),h=new T(this.emitter);this.appendChildren([_,a,h])}}var ee=Object.defineProperty,te=(n,e,t)=>e in n?ee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ne=(n,e,t)=>(te(n,typeof e!="symbol"?e+"":e,t),t);class re extends E.A{constructor(e){super({className:"app-container__page winners-page"}),ne(this,"router"),this.router=e;const t=new C.A(e,s.Y.WINNERS),_=new k;this.appendChildren([t,_])}}},383:(y,w,u)=>{u.d(w,{A:()=>g});var E=Object.defineProperty,C=(p,f,o)=>f in p?E(p,f,{enumerable:!0,configurable:!0,writable:!0,value:o}):p[f]=o,s=(p,f,o)=>(C(p,typeof f!="symbol"?f+"":f,o),o);class g{constructor(){s(this,"handlers",{})}on(f,o){const l=this.handlers[f]||[];l.length===0&&(this.handlers[f]=l),l.push(o)}off(f,o){const l=this.handlers[f];if(l)for(let r=0;r<l.length;r+=1)l[r]===o&&l.splice(r-=1,1)}emit(f,o){const l=this.handlers[f];l&&l.forEach(r=>r(o))}}}}]);
